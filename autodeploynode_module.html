

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Autodeploynode Module &mdash; CSC DCAF 1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="CSC DCAF 1.0 documentation" href="index.html"/>
        <link rel="next" title="Bare-Metal-OS Module" href="bare_metal_os_module.html"/>
        <link rel="prev" title="Requirements &amp; Dependencies" href="requirements.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> CSC DCAF
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">CSC DCAF Quick Start Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements &amp; Dependencies</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Autodeploynode Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#install-the-rhel-os">Install the RHEL OS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#set-the-static-ip">Set the Static IP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set-the-hostname">Set the Hostname</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configure-autodeploynode">Configure Autodeploynode</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scripted-install">Scripted Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="#manual-install">Manual Install</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#register-with-subscription-manager">Register with Subscription Manager</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-support-packages">Install Support Packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-ansible">Install Ansible</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stage-the-csc-dcaf-project-resources">Stage the CSC DCAF Project Resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-dcaf-base-variables">Configure DCAF Base variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-autodeploynode-playbook">Running the Autodeploynode Playbook</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bare_metal_os_module.html">Bare-Metal-OS Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="kvm_host_module.html">KVM-Host Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rhel_osp_module.html">RHEL-OSP Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="known_issues.html">Known Issues and Troubleshooting</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">CSC DCAF</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Autodeploynode Module</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/autodeploynode_module.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="autodeploynode-module">
<h1>Autodeploynode Module<a class="headerlink" href="#autodeploynode-module" title="Permalink to this headline">¶</a></h1>
<p>The <strong>Autodeploynode</strong> is the main component of CSC DCAF project. This node contains
all the source files and dependencies to support operation of the framework. It is
connected to an external network with direct access to automation resources. Since
our projects have multiple dependencies we have automated the process to install
and configure the Autodeploynode as much as possible.</p>
<div class="section" id="install-the-rhel-os">
<h2>Install the RHEL OS<a class="headerlink" href="#install-the-rhel-os" title="Permalink to this headline">¶</a></h2>
<p>The first step is to install RHEL. This can be a physical or virtual machine as
long as all the requirements are met.</p>
<p>Using the media that is appropriate for your hardware boot into the RHEL
installation.</p>
<p>On the installation summary page, you may see different selections with yellow
exclamation or warning marks. These are areas that require some setup:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Date &amp; Time : Current Date / Time ? Time Zone
Installation Source : Local Media
Software Selection : Minimal Install
Installation Destination : Partitioning : Automatically configure partitioning
Network &amp; Hostname : Enable the network interface and configure with relative
static network information
Root Password : Set the root password
Create User: autodeploy
</pre></div>
</div>
<p>Here is a link to the <a class="reference external" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Installation_Guide/sect-installation-graphical-mode-x86.html">Red Hat Install guide</a></p>
<div class="section" id="set-the-static-ip">
<h3>Set the Static IP<a class="headerlink" href="#set-the-static-ip" title="Permalink to this headline">¶</a></h3>
<p>Boot the Autodeploynode and configure the network interface with a static IP address.
For more information refer to the <a class="reference external" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Networking_Guide/sec-Using_the_Command_Line_Interface.html">networking guide using the command line interface</a>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>vi /etc/sysconfig/network-scripts/ifcfg-&lt;nic&gt;
</pre></div>
</div>
<p>Modify this file to resemble this configuration with your specific network
configuration.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">BOOTPROTO</span><span class="o">=</span><span class="s2">&quot;none&quot;</span>
<span class="nv">ONBOOT</span><span class="o">=</span>yes
<span class="nv">IPADDR</span><span class="o">=</span>x.x.x.x
<span class="nv">NETMASK</span><span class="o">=</span>x.x.x.x
<span class="nv">GATEWAY</span><span class="o">=</span>x.x.x.x
<span class="nv">DNS1</span><span class="o">=</span>x.x.x.x
</pre></div>
</div>
</div>
<div class="section" id="set-the-hostname">
<h3>Set the Hostname<a class="headerlink" href="#set-the-hostname" title="Permalink to this headline">¶</a></h3>
<p>Next configure the hostname:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>hostnamectl set-hostname autodeploy.local
</pre></div>
</div>
<p>Now that the OS has been installed it is time to stage the automation resources.</p>
</div>
</div>
<div class="section" id="configure-autodeploynode">
<h2>Configure Autodeploynode<a class="headerlink" href="#configure-autodeploynode" title="Permalink to this headline">¶</a></h2>
<p>The Autodeploynode is responsible for all automation resources for a given project
or module. The base CSC DCAF resources will be staged directly to it as part of
the configuration.</p>
<div class="section" id="scripted-install">
<h3>Scripted Install<a class="headerlink" href="#scripted-install" title="Permalink to this headline">¶</a></h3>
<p>The build of the Autodeploynode is scripted and can be run after a few environment
variables have been defined. It will need to install packages and download files
needed by RHEL so it needs to be registered with subscription-manager. Environment
variables for Red Hat Subscription credentials should be defined:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">RHN_USER</span><span class="o">=</span><span class="s2">&quot;username&quot;</span>
<span class="nb">export</span> <span class="nv">RHN_PASS</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="c1"># escape dollar signs (\\$)</span>
<span class="nb">export</span> <span class="nv">RHN_POOL</span><span class="o">=</span><span class="s2">&quot;pool_id&quot;</span> <span class="c1"># 32-char pool ID</span>
</pre></div>
</div>
<p>With the environment variables defined, the build script can be launched:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>curl https://raw.githubusercontent.com/csc/dcaf/master/modules/autodeploynode/build.sh <span class="p">|</span> bash
</pre></div>
</div>
<p>Review the details in the build script for a description of tasks performed to build
the Autodeploynode.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="code docutils literal"><span class="pre">build.sh</span></code> script will perform a complete stage and configuration
of the Autodeploynode using all project defaults. If there are changes required
for your environment, a manual installation should be performed.</p>
</div>
</div>
<div class="section" id="manual-install">
<h3>Manual Install<a class="headerlink" href="#manual-install" title="Permalink to this headline">¶</a></h3>
<p>The Autodeploynode will need to install packages and download files needed by RHEL
so it needs to be registered with subscription-manager.</p>
<div class="section" id="register-with-subscription-manager">
<h4>Register with Subscription Manager<a class="headerlink" href="#register-with-subscription-manager" title="Permalink to this headline">¶</a></h4>
<p>Most commands require elevated privileges so you may need to <code class="code docutils literal"><span class="pre">su</span> <span class="pre">-</span></code>. Register
with Red Hat Subscription Manager. Fill in the username and password with credentials
that have a valid Red Hat subscription associated with it.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>su -
subscription-manager register --username<span class="o">=</span>your_user --password<span class="o">=</span>your_password
</pre></div>
</div>
<p>Find one of the repositories that include &#8220;Red Hat Openstack&#8221;. Once a subscription
is found that provides Openstack note the &#8220;Pool ID&#8221;</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>subscription-manager list --all --available
subscription-manager attach --pool<span class="o">=</span><span class="s2">&quot;Pool ID&quot;</span>
</pre></div>
</div>
<p>Disable all repositories, then enable RPM repositories as needed.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>subscription-manager repos --disable<span class="o">=</span>*
subscription-manager repos --enable<span class="o">=</span>rhel-7-server-rpms <span class="se">\</span>
--enable<span class="o">=</span>rhel-7-server-optional-rpms <span class="se">\</span>
--enable<span class="o">=</span>rhel-7-server-extras-rpms <span class="se">\</span>
--enable<span class="o">=</span>rhel-7-server-openstack-6.0-rpms <span class="se">\</span>
--enable<span class="o">=</span>rhel-server-rhscl-7-rpms <span class="se">\</span>
--enable<span class="o">=</span>rhel-ha-for-rhel-7-server-rpms
</pre></div>
</div>
</div>
<div class="section" id="install-support-packages">
<h4>Install Support Packages<a class="headerlink" href="#install-support-packages" title="Permalink to this headline">¶</a></h4>
<p>Next install the required support packages; <code class="docutils literal"><span class="pre">epel-release,</span> <span class="pre">git</span> <span class="pre">and</span> <span class="pre">wget.</span></code></p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>yum -y install https://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-6.noarch.rpm
yum -y install git wget
</pre></div>
</div>
</div>
<div class="section" id="install-ansible">
<h4>Install Ansible<a class="headerlink" href="#install-ansible" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ansible v2.0 is currently not available from EPEL and must be installed from
source.</p>
</div>
<p>To build an Ansible RPM from source, additional packages are required:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>yum -y install rpm-build make asciidoc python2-devel python-setuptools
</pre></div>
</div>
<p>Now the source for Ansible must be cloned. A particular version of Ansible is
currently tested and supported for use, as indicated below. The new RPM is
installed as well as additional Ansible dependencies.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git clone git://github.com/ansible/ansible.git --recursive
<span class="nb">cd</span> ansible/
git checkout v2.0.1.0-1
git submodule update --init --recursive
make rpm
yum -y --nogpgcheck localinstall ./rpm-build/ansible-*.noarch.rpm
<span class="nb">cd</span> ..
</pre></div>
</div>
</div>
<div class="section" id="stage-the-csc-dcaf-project-resources">
<h4>Stage the CSC DCAF Project Resources<a class="headerlink" href="#stage-the-csc-dcaf-project-resources" title="Permalink to this headline">¶</a></h4>
<p>Ansible has been installed and will be used to perform an automated download of
the CSC DCAF project resources. First we need to download the <code class="docutils literal"><span class="pre">initial_stage</span></code>
playbook from the <code class="docutils literal"><span class="pre">dcaf</span></code> Git repository.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>wget https://raw.githubusercontent.com/csc/dcaf/master/modules/autodeploynode/initial_stage.yml
</pre></div>
</div>
<p>Now the initial_stage.yml playbook can be run, as shown below:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ansible-playbook initial_stage.yml
</pre></div>
</div>
<p>Now that the CSC DCAF project has been retrieved the Autodeploynode module can be
used to install the remaining support packages. Change into the Autodeploynode
module directory.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> /opt/autodeploy/projects/dcaf/modules/autodeploynode
</pre></div>
</div>
<p>Next run the <code class="docutils literal"><span class="pre">stage_resources.yml</span></code> playbook to download the remaining CSC DCAF
automation resources. The <code class="docutils literal"><span class="pre">stage_resources.yml</span></code> play requires a valid user account
for Red Hat as outlined in the <code class="docutils literal"><span class="pre">User</span> <span class="pre">Access</span> <span class="pre">Requirements</span></code> section of
<a class="reference external" href="http://csc.github.io/dcaf/requirements.html">http://csc.github.io/dcaf/requirements.html</a>. Before you run the play change edit
the following variables in the <code class="docutils literal"><span class="pre">inventory/group_vars/all.yml</span></code> file.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># Required User Variables</span>
<span class="l l-Scalar l-Scalar-Plain">rhn_user</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">rhn_pass</span><span class="p p-Indicator">:</span>
</pre></div>
</div>
<p>Run the stage_resources.yml playbook:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ansible-playbook stage_resources.yml
</pre></div>
</div>
</div>
<div class="section" id="configure-dcaf-base-variables">
<h4>Configure DCAF Base variables<a class="headerlink" href="#configure-dcaf-base-variables" title="Permalink to this headline">¶</a></h4>
<p>Now that the Autodeploynode has the CSC DCAF resources staged it can be configured
to use other modules and projects. Before any playbooks can be run, the configuration
variables need to be edited per your environment. Configure these variables accordingly
by editing the variables in the <code class="docutils literal"><span class="pre">dcaf/modules/autodeploynode/inventory/group_vars/all.yml</span></code>.</p>
<p>There following variables apply to all deployments that will need to be modified
before deployment.</p>
<p>By default, the DHCP server will be installed with the following configuration:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">dns1</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8.8.8.8</span>
<span class="l l-Scalar l-Scalar-Plain">dhcp_start</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="l l-Scalar l-Scalar-Plain">dhcp_end</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">60</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The DHCP start and end values above are the last octet of the subnet the server
is installed in. For example,
172.17.16.20 would be <code class="docutils literal"><span class="pre">dhcp_start:</span> <span class="pre">20</span></code>
172.17.16.60 would be <code class="docutils literal"><span class="pre">dhcp_end:</span> <span class="pre">60</span></code></p>
</div>
<p>To use alternate values, edit the <code class="docutils literal"><span class="pre">dcaf/modules/autodeploynode/roles/dhcp-server/defaults.yml</span></code>
file with your own values.</p>
</div>
<div class="section" id="running-the-autodeploynode-playbook">
<h4>Running the Autodeploynode Playbook<a class="headerlink" href="#running-the-autodeploynode-playbook" title="Permalink to this headline">¶</a></h4>
<p>Now that the variables have been configured, run the following playbooks to finish the AutoDeployNode deployment.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ansible-playbook main.yml
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The <code class="docutils literal"><span class="pre">main.yml</span></code> playbook will also run the <code class="docutils literal"><span class="pre">site_docker.yml</span></code> and <code class="docutils literal"><span class="pre">site_discovery.yml</span></code>
playbooks.</p>
<p>The <code class="docutils literal"><span class="pre">site_docker.yml</span></code> playbook will start the Hanlon Docker environment. First
it will clean up any existing containers. Then it will start the Mongo, Hanlon
Server and TFTP Server containers.</p>
<p class="last">The <code class="docutils literal"><span class="pre">site_discovery.yml</span></code> playbook will configure the DHCP service and prepare
the Hanlon Server for the bare metal OS deployment.</p>
</div>
<p>At this point the AutoDeployNode has been configured and is ready to start using
for automation.</p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bare_metal_os_module.html" class="btn btn-neutral float-right" title="Bare-Metal-OS Module" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="requirements.html" class="btn btn-neutral" title="Requirements &amp; Dependencies" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, CSC.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>